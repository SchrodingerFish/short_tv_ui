# Cloudflare Pages 快速部署

## 方案 1: 通过 Dashboard（最简单）

1. 访问 https://dash.cloudflare.com/
2. 进入 **Pages** → **创建项目**
3. 连接您的 Git 仓库
4. 构建配置：
   ```
   构建命令: npm run build
   构建输出目录: dist
   Root directory: /
   ```
5. 环境变量（可选）：
   ```
   NODE_VERSION = 20
   ```
6. 点击**保存并部署**

## 方案 2: 使用 Wrangler CLI

```bash
# 1. 安装 Wrangler
npm install -g wrangler

# 2. 登录 Cloudflare
wrangler login

# 3. 部署（首次会提示创建项目）
npm run deploy:cf

# 或手动执行
npm run build
wrangler pages deploy dist --project-name=short-tv-ui
```

## 方案 3: GitHub Actions 自动部署

1. 在 Cloudflare Dashboard 创建 API Token：
   - 进入 **My Profile** → **API Tokens**
   - 创建 Token，权限选择 **Cloudflare Pages - Edit**
   
2. 在 GitHub 仓库设置 Secrets：
   - `CLOUDFLARE_API_TOKEN`: 刚创建的 API Token
   - `CLOUDFLARE_ACCOUNT_ID`: 在 Cloudflare Dashboard 右侧可以找到

3. 推送到 main/master 分支即可自动部署

## 验证部署

访问您的 Cloudflare Pages URL，测试：

- ✅ 主页加载
- ✅ 路由切换（/player, /favorites 等）
- ✅ 页面刷新（不应出现 404）
- ✅ Service Worker 注册（F12 → Application → Service Workers）
- ✅ PWA 安装提示

## 关键配置文件

- `public/_redirects` - SPA 路由配置
- `public/_headers` - HTTP 头部和缓存策略
- `wrangler.toml` - Wrangler CLI 配置（可选）
- `.github/workflows/deploy-cloudflare-pages.yml` - CI/CD 配置（可选）

## 常见问题

### 问题: 刷新页面 404

**原因**: `_redirects` 文件未生效

**解决**:
1. 确认 `public/_redirects` 存在
2. 重新构建 `npm run build`
3. 检查 `dist/_redirects` 是否存在

### 问题: Service Worker 不工作

**原因**: 缓存策略问题

**解决**:
1. 检查 `public/_headers` 中 `/sw.js` 配置
2. 清除浏览器缓存
3. 确保使用 HTTPS（Cloudflare Pages 自动提供）

### 问题: 静态资源加载慢

**解决**: Cloudflare Pages 自带全球 CDN，通常很快。如果慢：
1. 检查资源是否正确打包到 `dist/assets/`
2. 验证 `_headers` 缓存配置
3. 使用 Cloudflare 的 Analytics 分析性能

## 更多资源

- [完整部署指南](./CLOUDFLARE_PAGES_DEPLOYMENT.md)
- [Cloudflare Pages 文档](https://developers.cloudflare.com/pages/)
- [Wrangler 文档](https://developers.cloudflare.com/workers/wrangler/)
